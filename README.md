# wallet_demo
Проект выполнен в качестве тестового задания.

## Изначальное техническое задание

### Описание проекта	

Проект представляет из себя REST API, 
которое позволяет  выполнять следующие действия:

1) зарегистрировать пользователя с указанием
    * начального баланса
    * валюты счета
    * email (уникальный, используется для входа)
    * пароля

2) аутентифицировать пользователя по почте и паролю

3) перевести средства со своего счета на счет другого пользователя (используйте формулу конвертации, если валюты счетов отличаются)

4) просмотреть список всех операций по своему счету

5) обновлять курсы валют со стороннего ресурса 
(например, exchangeratesapi.io) раз в N времени (например, раз в 3 минуты)

Система должна поддерживать следующие валюты: EUR, USD, GPB и RUB.

### Требования к системе

* система должна быть реализована на любом python-фреймворке на ваш выбор: Django, Flask, aiohttp, Sanic, Bottle и пр.
* для хранения данных должна использоваться СУБД Postgres
* код должен запускаться в Docker-контейнерах
* код должен быть покрыт unit-тестами


## Реализация

Для реализация был выбран стэк Django и Django Rest Framework.

### Запуск проекта
Проект упакован в Docker, поэтому для запуска используйте следующую команду:
```bash
docker-compose up
```

Чтобы запустить проект в режиме разработки (дебага), нужно 
* в настройках изменить `DATABASES['default']['HOST']` на `127.0.0.1`;
* остановить контейнер с приложением `docker-compose stop web`;
* запустить приложение локально `./manage.py runserver`

### Запуск тестов
```
pytest
```

### Примеры запросов к API

1) Ручка регистрации и создания кошелька
    ```bash
    curl -X POST \
    http://0.0.0.0:8000/api/v1/signup/ \
        -H 'Content-Type: application/json' \
        -H 'Host: 0.0.0.0:8000' \
        -d '{
            "email": "test@test.com",
            "password1": "psswd",
            "password2": "psswd",
            "init_balance": 50,
            "currency": "USD"
        }'
    ```

2) Ручка авторизации
    ```bash
    curl -X POST \
    http://0.0.0.0:8000/api/v1/signin/ \
        -H 'Content-Type: application/json' \
        -H 'Host: 0.0.0.0:8000' \
        -d '{
            "username": "test@test.com",
            "password": "psswd"
        }'
    ```
    В ответ придёт токен, который нужен для авторизации.

3) Перевод денег между кошельками
    ```bash
    curl -X POST \
    http://0.0.0.0:8000/api/v1/transmit_money/ \
        -H 'Authorization: Token e512c72da17b41363e3571bb82e65fadd366ca34' \
        -H 'Content-Type: application/json' \
        -H 'Host: 0.0.0.0:8000' \
        -d '{
            "sender": 1,
            "recipient": 2,
            "amount": 40.59
        }'
    ```

4) Просмотр транзакций по кошельку
    ```bash
    curl -X GET \
    http://0.0.0.0:8000/api/v1/transactions/1/ \
        -H 'Authorization: Token e512c72da17b41363e3571bb82e65fadd366ca34' \
        -H 'Content-Type: application/json' \
        -H 'Host: 0.0.0.0:8000'
    ```
5) Принудительно обновить курсы валют
    ```bash
    ./manage.py update_exchange_rates
    ```


## Предложения по улучшению
Приложение можно улучшить и довести до уровня "продакшн" следующими действиями:

1) добавление в Docker сервер (например, Nginx);
2) добавление документирования эндпойнтов (например, Swagger);
3) профилирование приложения и отлов ошибок (напримре, Sentry);
4) использование переменных среды для разделения на локальную разработку, dev и prod сервер
(например, django-environ);
5) слой для перевода переменных в `camelCase` 
(например, [DRF-Camel-Case](https://github.com/vbabiy/djangorestframework-camel-case))
(для более удобной работы frontend-разработчиков);
6) создание фикстур, чтобы не создавать объекты в каждом тесте;
7) осуществлять транзакции в фоне (например, Celery).
